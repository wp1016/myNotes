<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>js判断鼠标进入方向 | 我的学习记录</title>
    <meta name="description" content="学习记录">
    
    
    <link rel="preload" href="/assets/css/0.styles.7dc567d6.css" as="style"><link rel="preload" href="/assets/js/app.858ddfaa.js" as="script"><link rel="preload" href="/assets/js/2.5004e8d4.js" as="script"><link rel="preload" href="/assets/js/13.433e10e3.js" as="script"><link rel="prefetch" href="/assets/js/10.1937ac51.js"><link rel="prefetch" href="/assets/js/11.476302ee.js"><link rel="prefetch" href="/assets/js/12.ad72436a.js"><link rel="prefetch" href="/assets/js/14.6204aac5.js"><link rel="prefetch" href="/assets/js/15.21b7313f.js"><link rel="prefetch" href="/assets/js/16.c674646e.js"><link rel="prefetch" href="/assets/js/3.19f73dc2.js"><link rel="prefetch" href="/assets/js/4.326d6dc7.js"><link rel="prefetch" href="/assets/js/5.7bbbddb3.js"><link rel="prefetch" href="/assets/js/6.19c01d84.js"><link rel="prefetch" href="/assets/js/7.6da62fb6.js"><link rel="prefetch" href="/assets/js/8.fa3b98eb.js"><link rel="prefetch" href="/assets/js/9.31efd1cb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7dc567d6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">我的学习记录</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/algorithms/" class="nav-link">数据结构</a></div><div class="nav-item"><a href="/http/" class="nav-link">网络协议</a></div><div class="nav-item"><a href="/docs/" class="nav-link">中文文档</a></div><div class="nav-item"><a href="/js/" class="nav-link router-link-active">js基础</a></div><div class="nav-item"><a href="/records/" class="nav-link">采坑记录</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/algorithms/" class="nav-link">数据结构</a></div><div class="nav-item"><a href="/http/" class="nav-link">网络协议</a></div><div class="nav-item"><a href="/docs/" class="nav-link">中文文档</a></div><div class="nav-item"><a href="/js/" class="nav-link router-link-active">js基础</a></div><div class="nav-item"><a href="/records/" class="nav-link">采坑记录</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>js判断鼠标进入方向</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/js判断鼠标进入方向.html" class="active sidebar-link">js判断鼠标进入方向</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>js事件循环机制</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="js判断鼠标进入方向"><a href="#js判断鼠标进入方向" class="header-anchor">#</a> js判断鼠标进入方向</h1> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#wrap&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">&quot;mouseenter mouseleave&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">var</span> w <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">var</span> h <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>pageX <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>offsetLeft <span class="token operator">-</span> <span class="token punctuation">(</span>w <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>w <span class="token operator">&gt;</span> h <span class="token operator">?</span> <span class="token punctuation">(</span>h <span class="token operator">/</span> w<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>pageY <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>offsetTop <span class="token operator">-</span> <span class="token punctuation">(</span>h <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;</span> w <span class="token operator">?</span> <span class="token punctuation">(</span>w <span class="token operator">/</span> h<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">var</span> direction <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">180</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">180</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">//direction的值为“0,1,2,3”分别对应着“上，右，下，左”</span>
           <span class="token keyword">var</span> eventType <span class="token operator">=</span> e<span class="token punctuation">.</span>type<span class="token punctuation">;</span>
           <span class="token keyword">var</span> dirName <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token string">'上方'</span><span class="token punctuation">,</span><span class="token string">'右侧'</span><span class="token punctuation">,</span><span class="token string">'下方'</span><span class="token punctuation">,</span><span class="token string">'左侧'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'mouseenter'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#result&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>dirName<span class="token punctuation">[</span>direction<span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'进入'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
              <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#result'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>dirName<span class="token punctuation">[</span>direction<span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'离开'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>就这么几行代码，将我印象里会有一长串的if else或者switch来完成的事完美的解决掉。在感到神奇之后，更多的是不解，因为看不懂。在网上搜索一番，也没有找到有谁来分析这个算法。于是自己研究了一下，现在写下来，作为自己的一份学习笔记，也希望能够和大家分享。</p> <p>有不对的地方，或者有更好的理解，请告诉我，谢谢！</p> <p>原理：以div容器的中心点作为圆心，以高和宽的最小值作为直径画圆，将圆以[π/4，3π/4)，[3π/4，5π/4），[5π/4，7π/4)，[-π/4，π/4)划分为四个象限，鼠标进入容器时的点的atan2(y,x)值在这四个象限里分别对应容器边框的下，右，上，左。如下图所示
<img src="http://note.youdao.com/yws/public/resource/c13c6dd61fc4d6a2e2486dad89189a4a/xmlnote/1D142F7295A14404BA023EF3A4456D84/351" alt="image"></p> <div class="language-js extra-class"><div class="highlight-lines"><br><br></div><pre class="language-js"><code><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>pageX <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>offsetLeft <span class="token operator">-</span> <span class="token punctuation">(</span>w <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>w <span class="token operator">&gt;</span> h <span class="token operator">?</span> <span class="token punctuation">(</span>h <span class="token operator">/</span> w<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>计算x坐标值时，如果点原来的x坐标的绝对值大于圆的半径值，则按 h/w 这个比例进行缩小，使得到的点的位置在容器的边界位置所对应的象限区间里。 y 坐标的计算也是一样。</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br></div><pre class="language-js"><code><span class="token keyword">var</span> direction <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">180</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">180</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">;</span>
</code></pre></div><p>((Math.atan2(y, x) * (180 / Math.PI)将点的坐标对应的弧度值换算成角度度数值，这里加上180并非必要，只是为了使得到的0,1,2,3能够与习惯性的上，右，下，左的位置对照，如果不加上180，得到的0,1,2,3就会分别对应下，右，上，左。
*修正：这里加上180不是并非必要的，而是在这个算法里必须的，因为atan2(y,x)返回值的范围是[-π,π],而不是我们习惯的[0,2π],负值会影响结果的正确性(比如右上和右下算出来的结果会不同)，而且确实也使得得到的结果0,1,2,3的顺序符合了习惯(原作者可能没想这个，只是css里总是这个顺序，或许是我自己的习惯~)。</p> <p>除以90，再取四舍五入值，是一个很精妙的用法，使得可以以45°为分界线。</p> <p>分析完这个算法后，我内心有些激动。这里并没有用到什么高深的知识，即使是三角函数的基础知识都可以不知道(虽然初中就学了)，但是可以用这么短短的三两行代码，就把我脑袋里浮现的那一长串的if else抛向云和山的彼端去，真的让我很难抑制内心的激动，深深的体会到算法之美，数学之美。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/js/js事件循环机制.html">js事件循环机制</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.858ddfaa.js" defer></script><script src="/assets/js/2.5004e8d4.js" defer></script><script src="/assets/js/13.433e10e3.js" defer></script>
  </body>
</html>
